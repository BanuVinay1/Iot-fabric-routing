IoT Hub â†’ Microsoft Fabric â†’ Eventhouse: Real-Time Streaming Architecture

ðŸ“Œ Project Overview
This project demonstrates a real-world implementation of streaming telemetry data from Azure IoT Hub to Microsoft Fabric Eventstream, and finally into structured Eventhouse tables.
This repo focuses exclusively on the connection, routing, schema resolution, and Fabric-specific pitfalls that often trip up production streaming pipelines.
âœ… This is a real pipeline setup, built with generic IoT data in mind.

ðŸŽ¯ Objectives
Establish a direct streaming connection from Azure IoT Hub to Microsoft Fabric
Route telemetry messages to multiple Eventhouse tables using event_type
Solve common Fabric-specific issues like:
-Cloud connection failures
-Schema/data type mismatches
-Required metadata columns

ðŸ§© Architecture
Azure IoT Hub (Event Hub-compatible endpoint)
        â†“
Fabric Eventstream (with consumer group)
        â†“
Filter on event_type
        â†“               â†“              â†“
 Eventhouse T1     Eventhouse T2    Eventhouse T3
 temperature       battery     

 âœ… Whatâ€™s Covered

1. IoT Hub to Fabric Integration
Use the Event Hub-compatible endpoint found under IoT Hub > Built-in Endpoints.
In Eventstream, use the Event Hub connector, not the IoT Hub one.
Choose the correct consumer group (see below).

2. Connection Errors & How We Solved Them
Errors like: Authoring failed, Cloud connection failed
Root cause: Fabric canâ€™t use $Default if it's in use or locked
âœ… Fix: Create a custom consumer group (e.g., fabric-cg) in IoT Hub â†’ Settings â†’ Built-in endpoints

3. Schema Mapping & Data Type Resolution
In the Eventhouse tables, you cant directly change the datatype while Editing schema. Instead of having to recreate the tables multiple attempts to fix each datatype mismatch, Here is a trick I used:
 - Leave the existing mistmatched column as it is, create a dummy column with corrrect datatype (Eg, leave 'PartitionId' - Int column as it is. Create 'PartitionId1' As 'Long')
 - Now Delete the PartitionId column. Rename PartitionId1 to PartitionId
This was the easiest work around available as of now in Eventhouse to fix datatype.

5. Required Metadata Fields
Fabric will auto-inject system columns into your output unless stripped. If your Eventhouse table doesnâ€™t have them, youâ€™ll get fatal errors like:
"The column 'PartitionId' generated by this transformation logic does not exist"
âœ… Ensure your Eventhouse table has:
PartitionId: long
EventProcessedUtcTime: datetime
EventEnqueuedUtcTime: datetime

ðŸ§  Gotchas & Learnings
Use Event Hub-compatible endpoints â€” not the IoT Hub connector.
Create a new consumer group â€” $Default is unreliable for Fabric.
Table types must match the incoming schema exactly. Use real, long, datetime, etc.
Rename trick works when table editor blocks you from changing types.
Add required metadata fields like PartitionId to avoid silent failures.
You can branch data to multiple Eventhouse tables using event_type filters in the Eventstream canvas.




